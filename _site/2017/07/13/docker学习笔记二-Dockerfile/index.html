<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>docker学习笔记(二)Dockerfile &mdash; code busy</title>
    <link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css">
    <link rel="stylesheet" href="/assets/vendor/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/assets/css/components/collection.css">
    <link rel="stylesheet" href="/assets/css/components/repo-card.css">
    <link rel="stylesheet" href="/assets/css/sections/repo-list.css">
    <link rel="stylesheet" href="/assets/css/sections/mini-repo-list.css">
    <link rel="stylesheet" href="/assets/css/components/boxed-group.css">
    <link rel="stylesheet" href="/assets/css/globals/common.css">
    <link rel="stylesheet" href="/assets/vendor/share.js/dist/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/globals/responsive.css">
    <link rel="stylesheet" href="/assets/css/posts/index.css">
    <!-- Latest compiled and minified CSS -->
    

    
    <link rel="canonical" href="http://0.0.0.0:4445/2017/07/13/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%BA%8C-Dockerfile/">
    <link rel="alternate" type="application/atom+xml" title="code busy" href="/feed.xml">
    <link rel="shortcut icon" href="/bolg_html_title.png">
    
    <meta property="og:title" content="docker学习笔记(二)Dockerfile">
      
    <meta name="keywords" content="docker install,docker helloworld">
    <meta name="og:keywords" content="docker install,docker helloworld">
      
    <meta name="description" content="docker学习笔记二–Dockerfile参考自官方文档-Dockerfile部分">
    <meta name="og:description" content="docker学习笔记二–Dockerfile参考自官方文档-Dockerfile部分">
      
    
    
        
    
    <meta property="og:url" content="http://0.0.0.0:4445/2017/07/13/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%BA%8C-Dockerfile/">
    <meta property="og:site_name" content="code busy">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh_CN" />
    
    <meta property="article:published_time" content="2017-07-13">
    
    <script src="/assets/vendor/jquery/dist/jquery.min.js"></script>
    <script src="/assets/js/jquery-ui.js"></script>
    <script type="text/javascript">
    function toggleMenu() {
        var nav = document.getElementsByClassName("site-header-nav")[0];
        if (nav.style.display == "inline-flex") {
          nav.style.display = "none";
        } else {
          nav.style.display = "inline-flex";
        }
    }
    </script>
</head>
<body class="" data-mz="">
    <header class="site-header">
        <div class="container">
            <h1><a href="/" title="code busy"><span class="octicon octicon-mark-github"></span> code busy</a></h1>
            <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <nav class="site-header-nav" role="navigation">
                
                <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a>
                
                <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a>
                
                <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a>
                
                <a href="/links/" class=" site-header-nav-item" target="" title="链接">链接</a>
                
                <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a>
                
            </nav>
        </div>
    </header>
    <!-- / header -->

    <section class="collection-head small geopattern" data-pattern-id="docker学习笔记(二)Do">
<div class="container">
  <div class="columns">
    <div class="column three-fourths">
      <div class="collection-title">
        <h1 class="collection-header">docker学习笔记(二)Dockerfile</h1>
        <div class="collection-info">
          
          <span class="meta-info">
            <span class="octicon octicon-calendar"></span> 2017/07/13
          </span>
          
          
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href="/categories/#docker" title="docker">docker</a>
          </span>
          
        </div>
      </div>
    </div>
  </div>
</div>
</section>
<!-- / .banner -->
<section class="container content">
<div class="columns">
  <div class="column three-fourths" >
    <article class="article-content markdown-body">
    <h2 id="docker学习笔记二dockerfile">docker学习笔记二–Dockerfile</h2>
<hr />
<p>参考自<a href="https://docs.docker.com/engine/reference/builder/#usage">官方文档-Dockerfile</a>部分</p>

<h3 id="一dockerfile中常用的指令简介">(一)Dockerfile中常用的指令简介</h3>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>FROM <span class="c">#来源于某个基础镜像</span>
FROM ubuntu 16.04


LABEL
ARG SPRING_PROFILE_ACTIVE <span class="c">#获取外部参数 SPRING_PROFILE_ACTIVE为外部参数的名称</span>
RUN  <span class="c">#运行镜像中系统级的命令</span>
RUN apt-get uppdate <span class="o">&amp;&amp;</span> apt-get install -y 

RUN apt-get update <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\</span>
    aufs-tools <span class="se">\</span>
    automake <span class="se">\</span>
    build-essential <span class="se">\</span>
    curl <span class="se">\</span>
    dpkg-sig <span class="se">\</span>
    libcap-dev <span class="se">\</span>
    libsqlite3-dev <span class="se">\</span>
    mercurial <span class="se">\</span>
    reprepro <span class="se">\</span>
    ruby1.9.1 <span class="se">\</span>
    ruby1.9.1-dev <span class="se">\</span>
    <span class="nv">s3cmd</span><span class="o">=</span>1.1.<span class="k">*</span> <span class="se">\</span>
 <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/<span class="k">*</span>

RUN <span class="o">[</span><span class="s2">"/bin/bash"</span>, <span class="s2">"-c"</span>, <span class="s2">"set -o pipefail &amp;&amp; wget -O - https://some.site | wc -l &gt; /number"</span><span class="o">]</span>

CMD  <span class="c">#运行非系统级别的命令</span>
CMD <span class="o">[</span><span class="s2">"perl"</span>, <span class="s2">"-de0"</span><span class="o">]</span>
ENV  <span class="c">#设置系统参数</span>
ADD or COPY 

COPY /home/userName/xxx.jar  /images/  <span class="c">#讲系统中的内容copy到镜像中的指定目录</span>
ENV profile <span class="k">${</span><span class="nv">SPRING_PROFILE_ACTIVE</span><span class="k">}</span> <span class="c">#设置参数  ${SPRING_PROFILE_ACTIVE}为外部传入参数</span>
CMD <span class="o">[</span>bash,-c,java -jar /xxx.jar --spring.profiles.active<span class="o">=</span><span class="k">${</span><span class="nv">profile</span><span class="k">}</span><span class="o">]</span>

<span class="o">(</span>/home/userName/xxx.jar为当前系统目录下的内容<span class="o">)</span> 目标地址为镜像目录 /images/
 
EXPOSE  <span class="c"># 不常用,后续补充该字段</span>
ENTRYPOINT
VOLUME
USER
WORKDIR
ONBUILD

</code></pre>
</div>
<h3 id="二一些简单的dockerfile示例">(二)一些简单的Dockerfile示例</h3>
<blockquote>
  <p>以下为一个简介版本的Dockerfile
``` bash
FROM openjdk:8
ARG SPRING_PROFILE_ACTIVE</p>
</blockquote>

<p>ENV SPRING_PROFILE_ACTIVE ${SPRING_PROFILE_ACTIVE}</p>

<p>COPY demo-www-1.0-SNAPSHOT.jar  /temp/</p>

<p>CMD [bash,-c,java -jar   /temp/demo-www-1.0-SNAPSHOT.jar –spring.profiles.active=${SPRING_PROFILE_ACTIVE}]</p>
<div class="highlighter-rouge"><pre class="highlight"><code>&gt; 项目中使用的镜像
``` bash 
# 基于一个简介版本的可运行jdk环境的docker镜像
FROM reg.longdai.com/base/openjdk:8u131-jdk-alpine

# 作者信息
MAINTAINER mritd &lt;mritd@mritd.me&gt;

# 获取参数
ARG SPRING_PROFILE_ACTIVE
ARG PROJECT_BUILD_FINALNAME

# 设置时区,项目参数,项目名称
ENV TZ 'Asia/Shanghai'
ENV SPRING_PROFILE_ACTIVE ${SPRING_PROFILE_ACTIVE}
ENV PROJECT_BUILD_FINALNAME ${PROJECT_BUILD_FINALNAME}

# 运行命令设置和安装 搭建项目所需要环境
RUN apk upgrade --update \
    &amp;&amp; apk add tzdata bash \
    &amp;&amp; ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
    &amp;&amp; echo "Asia/Shanghai" &gt; /etc/timezone \
    &amp;&amp; rm -rf /var/cache/apk/*

# copy 项目中可运行的jar包到镜像中
COPY target/${PROJECT_BUILD_FINALNAME}.jar /${PROJECT_BUILD_FINALNAME}.jar

# 执行启动命令,项目使用spring-boot框架搭建,所以直接使用此命令就好
CMD ["bash","-c","java -jar /${PROJECT_BUILD_FINALNAME}.jar --spring.profiles.active=${SPRING_PROFILE_ACTIVE}"]

# 更复杂的Dockerfile待更新
</code></pre>
</div>

<h3 id="三build-dcokerfile">(三)build Dcokerfile</h3>
<p>写完Dockerfile后,使用docker build 命令build自己的镜像</p>
<div class="language-sh highlighter-rouge"><pre class="highlight"><code>docker build /path/to/a/Dockerfile  -t testDocker:1.2 .

docker -H https://githu.com/xxx/xxx.git  build -t image_name:1.12 --build-arg <span class="nv">SPRING_PROFILE_ACTIVE</span><span class="o">=</span>dohko   <span class="nv">PROJECT_BUILD_FINALNAME</span><span class="o">=</span>longdai-p2p-core longdai-core

<span class="c"># 为镜像指定tag</span>
docker -H <span class="nv">$DOHKO_BUILD_HOST_19</span> tag <span class="nv">$IMAGE_NAME</span> <span class="nv">$LATEST_IMAGE_NAME</span>

<span class="c"># 将镜像push到指定仓库</span>
docker -H <span class="nv">$DOHKO_BUILD_HOST_19</span> push <span class="nv">$IMAGE_NAME</span>

<span class="c"># 删除本地的docker镜像</span>
docker -H <span class="nv">$DOHKO_BUILD_HOST_19</span>  rmi <span class="nv">$IMAGE_NAME</span>

<span class="c"># 指定build的文件来源地址</span>
-H https://githu.com/xxx/xxx.git 
<span class="c"># build后的镜像名称为: image_name:1.12 </span>
build -t image_name:1.12 
<span class="c"># build 时带入的参数</span>
--build-arg <span class="nv">SPRING_PROFILE_ACTIVE</span><span class="o">=</span>dohko   <span class="nv">PROJECT_BUILD_FINALNAME</span><span class="o">=</span>longdai-p2p-core
<span class="c"># build的文件中的目录</span>
longdai-core



</code></pre>
</div>
<p>更多详细的命令参考<a href="https://docs.docker.com/engine/reference/builder/">官方文档Dockerfile reference</a></p>


    

    </article>
    <div class="share">
      <div class="share-component"></div>
    </div>
    <div class="comment">
      
  
      
      
  


    </div>
  </div>
  <div class="column one-fourth">
    
<h3>Search</h3>
<div id="site_search">
    <input type="text" id="search_box" placeholder="Search">
    <button class="btn btn-default" id="site_search_do"><span class="octicon octicon-search"></span></button>
</div>

<ul id="search_results"></ul>

<link rel="stylesheet" type="text/css" href="/assets/css/modules/sidebar-search.css">
<script src="/assets/js/lunr.min.js"></script>
<script src="/assets/js/search.js"></script>


    
<h3 class="mobile-hidden">Post Directory</h3>
<div id="post-directory-module" class="mobile-hidden">
  <section class="post-directory">
  <!-- Links that trigger the jumping -->
  <!-- Added by javascript below -->
  <dl></dl>
  </section>
</div>

<script src="/assets/js/jquery.toc.js"></script>

  </div>
</div>
</section>
<!-- /section.content -->

    <footer class="container">
        <div class="site-footer" role="contentinfo">
            <div class="copyright left mobile-block">
                    © 2015
                    <span title="liushan">liushan</span>
                    <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
            </div>

            <ul class="site-footer-links right mobile-hidden">
                <li>
                    <a href="javascript:window.scrollTo(0,0)" >TOP</a>
                </li>
            </ul>
            <a href="http://github.com/liushan150/liushan150.github.io" target="_blank" aria-label="view source code">
                <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
            </a>
            <ul class="site-footer-links mobile-hidden">
                
                <li>
                    <a href="/" title="首页" target="">首页</a>
                </li>
                
                <li>
                    <a href="/categories/" title="分类" target="">分类</a>
                </li>
                
                <li>
                    <a href="/wiki/" title="维基" target="">维基</a>
                </li>
                
                <li>
                    <a href="/links/" title="链接" target="">链接</a>
                </li>
                
                <li>
                    <a href="/about/" title="关于" target="">关于</a>
                </li>
                
                <li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li>
            </ul>

        </div>
    </footer>
    <!-- / footer -->
    <script src="/assets/vendor/share.js/dist/js/share.min.js"></script>
    <script src="/assets/js/geopattern.js"></script>
    <script src="/assets/js/prism.js"></script>
    <link rel="stylesheet" href="/assets/css/globals/prism.css">
    <script>
      jQuery(document).ready(function($) {
        // geopattern
        $('.geopattern').each(function(){
          $(this).geopattern($(this).data('pattern-id'));
        });
       // hljs.initHighlightingOnLoad();
      });
    </script>
    
</body>
</html>
